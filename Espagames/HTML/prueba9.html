<!DOCTYPE html>
<html>
<head>
  <title>Espagames</title>    
</head>
<body>

<div class="cubo">
  <div class="cubo1">
    <div class="libro">
      <div class="hojas" id="paginaIzquierda"></div>
      <div class="hojas" id="paginaDerecha"></div>
    </div>
  </div>

  <div class="cubo2">
    <button class="verificacion" onclick="verificarRespuesta()">VERIFICAR</button>

    <div class="puntos">
      <div class="correcto">C: <span id="correctos">0</span></div>
      <div class="incorrecto">F: <span id="incorrectos">0</span></div>
    </div>

    <img src="../imagenes/pequenin53.png">
    <div class="tiempo" id="tiempo">5:00</div>
  </div>
</div>

<div id="resultado" class="res" style="display:none;">
  <h2>Juego terminado</h2>
  <p>Puntuaci칩n final: <span id="puntajeFinal"></span></p>
  <p>Nota: <span id="nota"></span></p>
  <div class="botones">
    <button class="boton2" onclick="location.reload()">Reiniciar</button>
    <button class="boton2" onclick="salir()">Escoger otro</button>
  </div>
</div>

<style>
    @import url("../CSS/prueba9.css");
</style>

<script>
let correctos = 0;
let incorrectos = 0;
let tiempo = 300;
let interval;

// Lista de cuentos
const cuentos = [
  { texto: "Hab칤a una vez una ni침a llamada Caperucita Roja que viv칤a en un peque침o pueblo. Un d칤a, su madre le pidi칩 que llevara comida a su abuela. En su camino, Caperucita Roja se encontr칩 con un lobo.", personaje: "Caperucita Roja" },
  { texto: "Los tres cerditos decidieron construir sus casas. El primero hizo una de paja, el segundo de madera y el tercero de ladrillos. Un lobo lleg칩 soplando para derribar las casas.", personaje: "cerditos" },
  { texto: "Blanca Nieves viv칤a con su madrastra, la reina malvada. Un d칤a, Blanca Nieves encontr칩 una casita donde viv칤an siete enanitos que la recibieron con cari침o.", personaje: "Blanca Nieves" },
  { texto: "Un patito feo naci칩 diferente a los dem치s. Todos se burlaban de 칠l. Con el tiempo, se convirti칩 en un hermoso cisne blanco.", personaje: "patito feo" },
  { texto: "Hansel y Gretel eran dos hermanos que viv칤an cerca de un bosque. Un d칤a, se perdieron y encontraron una casita hecha de dulces donde viv칤a una bruja.", personaje: "Hansel" }
];

let cuentoActual;

// Seleccionar un cuento al azar
function nuevoCuento() {
  cuentoActual = cuentos[Math.floor(Math.random() * cuentos.length)];
  cargarTexto();
}

// Mostrar texto en las dos p치ginas
function cargarTexto() {
  const palabras = cuentoActual.texto.split(" ");
  const mitad = Math.ceil(palabras.length / 2);

  const izquierda = document.getElementById("paginaIzquierda");
  const derecha = document.getElementById("paginaDerecha");
  izquierda.innerHTML = "";
  derecha.innerHTML = "";

  palabras.forEach((palabra, i) => {
    const span = document.createElement("span");
    span.classList.add("palabra");
    span.innerText = palabra + " ";
    span.onclick = () => span.classList.toggle("marcada");

    if (i < mitad) {
      izquierda.appendChild(span);
    } else {
      derecha.appendChild(span);
    }
  });
}

const sonidoCorrecto = new Audio('../sonidos/correct-156911.mp3');
const sonidoIncorrecto = new Audio('../sonidos/error-3-125761.mp3');

function verificarRespuesta() {
  const seleccionadas = Array.from(document.querySelectorAll(".marcada")).map(el => el.innerText.trim());
  const textoSeleccionado = seleccionadas.join(" ");
  
  if (textoSeleccionado.includes(cuentoActual.personaje)) {
    correctos++;
    sonidoCorrecto.play();
  } else {
    incorrectos++;
    sonidoIncorrecto.play(); 
  }

  document.getElementById('correctos').innerText = correctos;
  document.getElementById('incorrectos').innerText = incorrectos;

  // 游녤 Cargar un nuevo cuento despu칠s de responder
  nuevoCuento();
}

function iniciarTemporizador() {
  interval = setInterval(() => {
    if (tiempo > 0) {
      tiempo--;
      const minutos = Math.floor(tiempo / 60);
      const segundos = tiempo % 60;
      document.getElementById('tiempo').innerText = 
        `${minutos.toString().padStart(2, '0')}:${segundos.toString().padStart(2, '0')}`;
    } else {
      clearInterval(interval);
      finalizarJuego();
    }
  }, 1000);
}

function finalizarJuego() {
  clearInterval(interval);
  const resultadoFinal = correctos - incorrectos;
  let nota = "F";
  if (resultadoFinal >= 4) nota = "A";
  else if (resultadoFinal >= 3) nota = "B";
  else if (resultadoFinal >= 2) nota = "C";
  document.getElementById('puntajeFinal').innerText = resultadoFinal;
  document.getElementById('nota').innerText = nota;
  document.getElementById('resultado').style.display = 'block';
}

function salir() {
  window.location.href = "Espagames.html";
}

window.onload = () => {
  nuevoCuento();  // Inicia con un cuento aleatorio
  iniciarTemporizador();
};
</script>

</body>
</html>
