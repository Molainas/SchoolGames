<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Espagames</title>
  </head>
  <body>
    <div class="cubo">
      <div class="cubo1">
        <div class="peque침in">
          <img src="../imagenes/pequenin51.png" />
        </div>

        <canvas class="texto" id="oracionCanvas"></canvas>

        <div class="caja">
          <img src="../imagenes/caja.png" />
        </div>
      </div>

      <div class="cubo2" id="opciones">
        <!-- Opciones din치micas -->
      </div>

      <div class="cubo3">
        <div class="correcto">C: <span id="correctos">0</span></div>
        <div class="tiempo" id="tiempo">05:00</div>
        <div class="incorrecto">F: <span id="incorrectos">0</span></div>
      </div>
    </div>

    <div id="resultado" class="res" style="display: none">
      <h2>Juego terminado</h2>
      <p>Puntuaci칩n final: <span id="puntajeFinal"></span></p>
      <p>Nota: <span id="nota"></span></p>
      <div class="botones">
        <button class="boton2" onclick="location.reload()">Reiniciar</button>
        <button class="boton2" onclick="salir()">Escoger otro</button>
      </div>
    </div>

    <style>
      @import url("../CSS/prueba7.css");
    </style>

    <script>
      let correctos = 0;
      let incorrectos = 0;
      let tiempo = 300;
      let interval;

      const oraciones = [
        {
          texto: "Yo ____ al colegio todos los d칤as.",
          respuesta: "voy",
          opciones: ["voy", "fui", "ir치"],
        },
        {
          texto: "Ellos ____ una pizza muy rica.",
          respuesta: "comen",
          opciones: ["comen", "comi칩", "com칤a"],
        },
        {
          texto: "Mar칤a ____ la guitarra en las tardes.",
          respuesta: "toca",
          opciones: ["tocaba", "toca", "tocar치"],
        },
        {
          texto: "Nosotros ____ f칰tbol los s치bados.",
          respuesta: "jugamos",
          opciones: ["jugamos", "jugaron", "jugar치"],
        },
      ];

      let indiceActual = 0;

      function iniciarTemporizador() {
        interval = setInterval(() => {
          if (tiempo > 0) {
            tiempo--;
            const minutos = Math.floor(tiempo / 60);
            const segundos = tiempo % 60;
            document.getElementById("tiempo").innerText = `${minutos
              .toString()
              .padStart(2, "0")}:${segundos.toString().padStart(2, "0")}`;
          } else {
            clearInterval(interval);
            finalizarJuego();
          }
        }, 1000);
      }

      function mostrarOracion() {
        const canvas = document.getElementById("oracionCanvas");
        const ctx = canvas.getContext("2d");

        // Ajustar tama침o del canvas al contenedor
        canvas.width = canvas.parentElement.clientWidth - 500;
        canvas.height = 120;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 游녤 Escoger oraci칩n al azar
        indiceActual = Math.floor(Math.random() * oraciones.length);
        const texto = oraciones[indiceActual].texto;
        const partes = texto.split(" ");

        // Ajustar tama침o de fuente para que quepa dentro del canvas
        let fontSize = 40;
        ctx.font = `${fontSize}px Cursive`;
        let anchoTexto = ctx.measureText(texto).width;
        while (anchoTexto > canvas.width - 20 && fontSize > 10) {
          fontSize--;
          ctx.font = `${fontSize}px Cursive`;
          anchoTexto = ctx.measureText(texto).width;
        }

        const xInicial = 10;
        const y = canvas.height / 2;
        let x = xInicial;
        const altoTexto = fontSize + 6;

        // Dibujar cada parte de la oraci칩n
        partes.forEach((parte) => {
          const anchoParte = ctx.measureText(parte + " ").width;

          if (parte !== "____") {
            ctx.fillStyle = "black";
            ctx.fillRect(x - 4, y - altoTexto + 8, anchoParte, altoTexto);
          }

          ctx.fillStyle = "white";
          ctx.fillText(parte, x, y);

          x += anchoParte;
        });

        // Opciones din치micas
        const opcionesDiv = document.getElementById("opciones");
        opcionesDiv.innerHTML = "";

        oraciones[indiceActual].opciones.forEach((opcion) => {
          const boton = document.createElement("div");
          boton.classList.add("opcion");
          boton.innerText = opcion;
          boton.onclick = () => verificarRespuesta(opcion);
          opcionesDiv.appendChild(boton);
        });
      }

      const sonidoCorrecto = new Audio("../sonidos/correct-156911.mp3");
      const sonidoIncorrecto = new Audio("../sonidos/error-3-125761.mp3");

      function verificarRespuesta(opcion) {
        if (opcion === oraciones[indiceActual].respuesta) {
          correctos++;
          document.getElementById("correctos").innerText = correctos;
          sonidoCorrecto.play();
        } else {
          incorrectos++;
          document.getElementById("incorrectos").innerText = incorrectos;
          sonidoIncorrecto.play();
        }

        // 游녤 En vez de terminar, seguimos mostrando otra oraci칩n
        if (tiempo > 0) {
          mostrarOracion();
        }
      }

      function finalizarJuego() {
        clearInterval(interval);
        const resultadoFinal = correctos - incorrectos;
        let nota = "F";
        if (resultadoFinal >= 10) nota = "A";
        else if (resultadoFinal >= 7) nota = "B";
        else if (resultadoFinal >= 4) nota = "C";
        document.getElementById("puntajeFinal").innerText = resultadoFinal;
        document.getElementById("nota").innerText = nota;
        document.getElementById("resultado").style.display = "block";
      }

      function salir() {
        window.location.href = "Espagames.html";
      }

      window.onload = () => {
        iniciarTemporizador();
        mostrarOracion();
      };

      window.onresize = mostrarOracion;
    </script>
  </body>
</html>
