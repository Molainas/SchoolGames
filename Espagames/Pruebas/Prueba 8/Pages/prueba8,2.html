<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Espagames</title>
  </head>
  <body>
    <div class="cubo">
      <div class="cubo1">
        <div class="punto">
          <div class="correcto">C: <span id="correctos">0</span></div>
          <div class="incorrecto">F: <span id="incorrectos">0</span></div>
        </div>
        <div class="tiempo" id="tiempo">05:00</div>
      </div>

      <div class="cubo2">
        <div class="texto" id="texto"></div>
        <div class="pequeñin"><img src="../imagenes/pequenin522.png" /></div>
        <canvas id="frasco" class="frasco" width="150" height="200"></canvas>
      </div>

      <div class="cubo3">
        <div class="textura" id="opcionesTextura"></div>

        <div class="olor" id="opcionesOlor"></div>
      </div>
    </div>

    <div id="resultado" class="res" style="display: none">
      <h2>Juego terminado</h2>
      <p>Puntuación final: <span id="puntajeFinal"></span></p>
      <p>Nota: <span id="nota"></span></p>
      <div class="botones">
        <button class="boton2" onclick="location.reload()">Reiniciar</button>
        <button class="boton2" onclick="salir()">Escoger otro</button>
      </div>
    </div>

    <style>
      @import url("../CSS/prueba8,2.css");
    </style>

    <script>
      let correctos = 0;
      let incorrectos = 0;
      let tiempo = 300;
      let interval;
      let ctx = document.getElementById("frasco").getContext("2d");

      const frases = [
        {
          texto: "El frasco contiene un líquido rugoso con olor a fuego.",
          textura: "áspero",
          olor: "quemado",
        },

        {
          texto:
            "El frasco contiene un polvo agradable cuando lo toco y huele a flores.",
          textura: "suave",
          olor: "floral",
        },

        {
          texto: "El frasco contiene un gel congelante con olor refrescante.",
          textura: "frío",
          olor: "menta",
        },

        {
          texto: "El frasco contiene un líquido denso que huele a basura.",
          textura: "espeso",
          olor: "podrido",
        },

        {
          texto: "El frasco tiene un material resistente con olor a caramelo.",
          textura: "duro",
          olor: "dulce",
        },
      ];

      // Opciones disponibles
      const texturas = ["áspero", "suave", "frío", "espeso", "duro"];
      const olores = ["quemado", "floral", "menta", "podrido", "dulce"];

      let fraseActual;
      let seleccionTextura = null;
      let seleccionOlor = null;

      function iniciarTemporizador() {
        interval = setInterval(() => {
          if (tiempo > 0) {
            tiempo--;
            const minutos = Math.floor(tiempo / 60);
            const segundos = tiempo % 60;
            document.getElementById("tiempo").innerText = `${minutos
              .toString()
              .padStart(2, "0")}:${segundos.toString().padStart(2, "0")}`;
          } else {
            clearInterval(interval);
            finalizarJuego();
          }
        }, 1000);
      }

      function dibujarFrasco(adjetivo) {
        ctx.clearRect(0, 0, 150, 200);
        ctx.strokeStyle = "#804000";
        ctx.lineWidth = 2;
        ctx.strokeRect(30, 30, 90, 150);
        ctx.strokeRect(55, 10, 40, 20);

        if (adjetivo === "frío") {
          ctx.fillStyle = "lightblue";
          ctx.fillRect(32, 32, 86, 146);
          ctx.fillStyle = "white";
          ctx.beginPath();
          ctx.arc(75, 60, 10, 0, Math.PI * 2);
          ctx.fill();
        }
        if (adjetivo === "áspero") {
          ctx.fillStyle = "gray";
          ctx.fillRect(32, 32, 86, 146);
          ctx.fillStyle = "black";
          for (let i = 40; i < 120; i += 10) {
            for (let j = 40; j < 160; j += 10) {
              ctx.fillRect(i, j, 2, 2);
            }
          }
        }
        if (adjetivo === "suave") {
          ctx.fillStyle = "pink";
          ctx.fillRect(32, 32, 86, 146);
        }
        if (adjetivo === "espeso") {
          ctx.fillStyle = "brown";
          ctx.fillRect(32, 100, 86, 78);
        }
        if (adjetivo === "duro") {
          ctx.fillStyle = "darkgray";
          ctx.fillRect(32, 32, 86, 146);
          ctx.fillStyle = "black";
          ctx.fillRect(50, 60, 20, 20);
          ctx.fillRect(80, 120, 20, 20);
        }
      }

      function mostrarFrase() {
        seleccionTextura = null;
        seleccionOlor = null;

        fraseActual = frases[Math.floor(Math.random() * frases.length)];
        document.getElementById("texto").innerText = fraseActual.texto;
        dibujarFrasco(fraseActual.textura);

        // Opciones de textura
        const contText = document.getElementById("opcionesTextura");
        contText.innerHTML = "";
        let opcionesT = [...texturas].sort(() => Math.random() - 0.5);
        opcionesT.forEach((op) => {
          const div = document.createElement("div");
          div.className = "opcion";
          div.innerText = op;
          div.onclick = () => {
            seleccionTextura = op;
            verificar();
          };
          contText.appendChild(div);
        });

        // Opciones de olor
        const contOlor = document.getElementById("opcionesOlor");
        contOlor.innerHTML = "";
        let opcionesO = [...olores].sort(() => Math.random() - 0.5);
        opcionesO.forEach((op) => {
          const div = document.createElement("div");
          div.className = "opcion";
          div.innerText = op;
          div.onclick = () => {
            seleccionOlor = op;
            verificar();
          };
          contOlor.appendChild(div);
        });
      }

      const sonidoCorrecto = new Audio("../sonidos/correct-156911.mp3");
      const sonidoIncorrecto = new Audio("../sonidos/error-3-125761.mp3");

      function verificar() {
        if (seleccionTextura && seleccionOlor) {
          if (
            seleccionTextura === fraseActual.textura &&
            seleccionOlor === fraseActual.olor
          ) {
            correctos++;
            document.getElementById("correctos").innerText = correctos;
            sonidoCorrecto.play();
          } else {
            incorrectos++;
            document.getElementById("incorrectos").innerText = incorrectos;
            sonidoIncorrecto.play();
          }
          mostrarFrase();
        }
      }

      function finalizarJuego() {
        clearInterval(interval);
        const resultadoFinal = correctos - incorrectos;
        let nota = "F";
        if (resultadoFinal >= 4) nota = "A";
        else if (resultadoFinal >= 3) nota = "B";
        else if (resultadoFinal >= 2) nota = "C";
        document.getElementById("puntajeFinal").innerText = resultadoFinal;
        document.getElementById("nota").innerText = nota;
        document.getElementById("resultado").style.display = "block";
      }

      function salir() {
        window.location.href = "Espagames2.html";
      }

      window.onload = () => {
        iniciarTemporizador();
        mostrarFrase();
      };
    </script>
  </body>
</html>
