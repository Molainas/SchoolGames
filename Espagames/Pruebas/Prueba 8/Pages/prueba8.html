<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>Espagames</title>
  </head>
  <body>
    <div class="cubo">
      <div class="cubo1">
        <div class="punto">
          <div class="correcto">C: <span id="correctos">0</span></div>
          <div class="incorrecto">F: <span id="incorrectos">0</span></div>
        </div>
        <div class="tiempo" id="tiempo">05:00</div>
      </div>

      <div class="cubo2">
        <div class="texto" id="texto"></div>
        <div class="pequeñin"><img src="../imagenes/pequenin52.png" /></div>
        <canvas id="frasco" class="frasco" width="150" height="200"></canvas>
      </div>

      <div class="cubo3" id="opciones"></div>
    </div>

    <div id="resultado" class="res" style="display: none">
      <h2>Juego terminado</h2>
      <p>Puntuación final: <span id="puntajeFinal"></span></p>
      <p>Nota: <span id="nota"></span></p>
      <div class="botones">
        <button class="boton2" onclick="location.reload()">Reiniciar</button>
        <button class="boton2" onclick="salir()">Escoger otro</button>
      </div>
    </div>

    <style>
      @import url("../CSS/prueba8.css");
    </style>

    <script>
      let correctos = 0;
      let incorrectos = 0;
      let tiempo = 300;
      let interval;
      let ctx = document.getElementById("frasco").getContext("2d");

      // Lista de frases y respuestas correctas
      const frases = [
        {
          texto:
            "El frasco contiene un líquido que se siente rugosa cuando lo toco.",
          respuesta: "áspero",
        },
        {
          texto: "El frasco contiene un polvo muy agradable a la mano.",
          respuesta: "suave",
        },
        {
          texto: "El frasco contiene un gel que me congela la mano.",
          respuesta: "frío",
        },
        {
          texto: "El frasco tiene un líquido con una alta densidad.",
          respuesta: "espeso",
        },
        { texto: "El frasco tiene un material resistente.", respuesta: "duro" },
      ];

      let fraseActual;

      function iniciarTemporizador() {
        interval = setInterval(() => {
          if (tiempo > 0) {
            tiempo--;
            const minutos = Math.floor(tiempo / 60);
            const segundos = tiempo % 60;
            document.getElementById("tiempo").innerText = `${minutos
              .toString()
              .padStart(2, "0")}:${segundos.toString().padStart(2, "0")}`;
          } else {
            clearInterval(interval);
            finalizarJuego();
          }
        }, 1000);
      }

      function dibujarFrasco(adjetivo) {
        ctx.clearRect(0, 0, 150, 200);

        // Frasco básico
        ctx.strokeStyle = "black";
        ctx.lineWidth = 2;
        ctx.strokeRect(30, 30, 90, 150); // cuerpo
        ctx.strokeRect(55, 10, 40, 20); // cuello

        // Según el adjetivo cambia el interior
        if (adjetivo === "frío") {
          ctx.fillStyle = "lightblue";
          ctx.fillRect(32, 32, 86, 146);
          ctx.fillStyle = "white";
          ctx.beginPath();
          ctx.arc(75, 60, 10, 0, Math.PI * 2);
          ctx.fill(); // hielito
        }

        if (adjetivo === "áspero") {
          ctx.fillStyle = "gray";
          ctx.fillRect(32, 32, 86, 146);
          ctx.fillStyle = "black";
          for (let i = 40; i < 120; i += 10) {
            for (let j = 40; j < 160; j += 10) {
              ctx.fillRect(i, j, 2, 2); // textura
            }
          }
        }

        if (adjetivo === "suave") {
          ctx.fillStyle = "pink";
          ctx.fillRect(32, 32, 86, 146);
        }

        if (adjetivo === "espeso") {
          ctx.fillStyle = "brown";
          ctx.fillRect(32, 100, 86, 78); // líquido denso
        }

        if (adjetivo === "duro") {
          ctx.fillStyle = "darkgray";
          ctx.fillRect(32, 32, 86, 146);
          ctx.fillStyle = "black";
          ctx.fillRect(50, 60, 20, 20);
          ctx.fillRect(80, 120, 20, 20);
        }
      }

      function mostrarFrase() {
        fraseActual = frases[Math.floor(Math.random() * frases.length)];
        document.getElementById("texto").innerText = fraseActual.texto;
        dibujarFrasco(fraseActual.respuesta);

        // Crear opciones (correcta + distractores)
        const opciones = [fraseActual.respuesta];
        while (opciones.length < 5) {
          const aleatorio =
            frases[Math.floor(Math.random() * frases.length)].respuesta;
          if (!opciones.includes(aleatorio)) opciones.push(aleatorio);
        }

        // Mezclar opciones
        opciones.sort(() => Math.random() - 0.5);

        const contenedor = document.getElementById("opciones");
        contenedor.innerHTML = "";
        opciones.forEach((op) => {
          const div = document.createElement("div");
          div.className = "opcion";
          div.innerText = op;
          div.onclick = () => verificarRespuesta(op);
          contenedor.appendChild(div);
        });
      }

      const sonidoCorrecto = new Audio("../sonidos/correct-156911.mp3");
      const sonidoIncorrecto = new Audio("../sonidos/error-3-125761.mp3");

      function verificarRespuesta(opcion) {
        if (opcion === fraseActual.respuesta) {
          correctos++;
          document.getElementById("correctos").innerText = correctos;
          sonidoCorrecto.play();
        } else {
          incorrectos++;
          document.getElementById("incorrectos").innerText = incorrectos;
          sonidoIncorrecto.play();
        }
        mostrarFrase();
      }

      function finalizarJuego() {
        clearInterval(interval);
        const resultadoFinal = correctos - incorrectos;
        let nota = "F";
        if (resultadoFinal >= 4) nota = "A";
        else if (resultadoFinal >= 3) nota = "B";
        else if (resultadoFinal >= 2) nota = "C";
        document.getElementById("puntajeFinal").innerText = resultadoFinal;
        document.getElementById("nota").innerText = nota;
        document.getElementById("resultado").style.display = "block";
      }

      function salir() {
        window.location.href = "Espagames.html";
      }

      window.onload = () => {
        iniciarTemporizador();
        mostrarFrase();
      };
    </script>
  </body>
</html>
