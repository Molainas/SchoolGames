<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Naturalgames</title>
</head>
<body>

<div class="cubo">
  <div class="cubo1">

    <div class="canasta">
      <div class="partes">S. nervioso</div>
      <div class="partes">S. cardiovascular</div>
      <div class="partes">S. respiratorio</div>
    </div>

    <canvas id="canvasCuerpo" width="515" height="600"></canvas>
    <div id="organoMovil"></div>

    <div class="canasta">
      <div class="partes">S. digestivo</div>
      <div class="partes">S. urinario</div>
      <div class="partes">S. esqueletico</div>
    </div>

  </div>

  <div class="cubo2">
    <div class="texto" id="partes">Sistema...</div>
    <img class="peque√±in" src="../imagenes/peque654.png" width="100">
    <div class="tiempo" id="tiempo">05:00</div>
    <div class="puntos">
      <div class="correcto">C: <span id="correctos">0</span></div>
      <div class="incorrecto">F: <span id="incorrectos">0</span></div>
    </div>
  </div>
</div>

<div id="resultado" class="res" style="display:none;">
  <h2>Juego terminado</h2>
  <p>Puntuaci√≥n final: <span id="puntajeFinal"></span></p>
  <p>Nota: <span id="nota"></span></p>
  <div class="botones">
    <button class="boton2" onclick="location.reload()">Reiniciar</button>
    <button class="boton2" onclick="salir()">Escoger otro</button>
  </div>
</div>

<style>
  @import url("../CSS/prueba6,2.css");
</style>

<script>
let correctos = 0;
let incorrectos = 0;
let tiempo = 300;
let interval;

const canvas = document.getElementById("canvasCuerpo");
const ctx = canvas.getContext("2d");
const orgElem = document.getElementById("organoMovil");

const organosBase = [

 
  { nombre: "Craneo", sistema: "S. esqueletico", x: 230, y: 110, w: 60, h: 40, tipo: "hueso" },

  { nombre: "Costillas", sistema: "S. esqueletico", x: 200, y: 200, w: 120, h: 120, tipo: "hueso" },

  { nombre: "Pelvis", sistema: "S. esqueletico", x: 210, y: 330, w: 100, h: 40, tipo: "hueso" },

  { nombre: "Cerebro", sistema: "S. nervioso", x: 230, y: 95, w: 60, h: 40, tipo: "organo", protegidoPor: "Craneo" },

  { nombre: "Coraz√≥n", sistema: "S. cardiovascular", x: 240, y: 200, w: 40, h: 40, tipo: "organo", protegidoPor: "Costillas" },

  { nombre: "Pulmones", sistema: "S. respiratorio", x: 220, y: 210, w: 80, h: 40, tipo: "organo", protegidoPor: "Costillas" },

  { nombre: "Est√≥mago", sistema: "S. digestivo", x: 260, y: 315, w: 60, h: 40, tipo: "organo", protegidoPor: "Costillas" },

  { nombre: "Ri√±√≥n", sistema: "S. urinario", x: 200, y: 330, w: 40, h: 40, tipo: "organo", protegidoPor: "Pelvis" },

  { nombre: "H√≠gado", sistema: "S. digestivo", x: 230, y: 250, w: 70, h: 40, tipo: "organo", protegidoPor: "Costillas" }
];

let organos = [];
let organoActual = null;
let huesosRetenidos = []; // üîπ huesos quitados sin puntuar

function clonarOrganos() {
  organos = organosBase.map(o => ({ ...o, extraido: false }));
}

function iniciarTemporizador() {
  interval = setInterval(() => {
    if (tiempo > 0) {
      tiempo--;
      const minutos = Math.floor(tiempo / 60);
      const segundos = tiempo % 60;
      document.getElementById("tiempo").innerText =
        `${minutos.toString().padStart(2, "0")}:${segundos.toString().padStart(2, "0")}`;
    } else {
      clearInterval(interval);
      finalizarJuego();
    }
  }, 1000);
}

function finalizarJuego() {
  clearInterval(interval);
  const resultadoFinal = correctos - incorrectos;
  let nota = "F";
  if (resultadoFinal >= 20) nota = "A";
  else if (resultadoFinal >= 10) nota = "B";
  else if (resultadoFinal >= 5) nota = "C";

  document.getElementById("puntajeFinal").innerText = resultadoFinal;
  document.getElementById("nota").innerText = nota;
  document.getElementById("resultado").style.display = "block";
}

function salir() {
  window.location.href = "Naturalgames2.html";
}

function dibujarCuerpoYOrganos() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // üîπ Dibujar cuerpo (piel simple)
  ctx.fillStyle = "yellow";
  ctx.beginPath();
  ctx.arc(260, 130, 40, 0, Math.PI * 2); // cabeza
  ctx.fill();
  ctx.fillRect(193, 180, 130, 200); // tronco
  ctx.fillRect(153, 190, 40, 140); // brazo izq
  ctx.fillRect(323, 190, 40, 140); // brazo der
  ctx.fillRect(198, 380, 40, 120); // pierna izq
  ctx.fillRect(280, 380, 40, 120); // pierna der

  // üîπ Dibujar √≥rganos despu√©s
  organos.forEach(o => {
    if (!o.extraido && o.tipo === "organo") {
      ctx.fillStyle = "green";
      if (o.nombre === "Cerebro") {
        ctx.beginPath();
        ctx.ellipse(o.x + o.w/2, o.y + o.h/2, o.w/2, o.h/2, 0, 0, Math.PI * 2);
        ctx.fill();
      } else if (o.nombre === "Coraz√≥n") {
        ctx.beginPath();
        ctx.moveTo(o.x + o.w/2, o.y + o.h/2);
        ctx.bezierCurveTo(o.x, o.y, o.x, o.y + o.h, o.x + o.w/2, o.y + o.h);
        ctx.bezierCurveTo(o.x + o.w, o.y + o.h, o.x + o.w, o.y, o.x + o.w/2, o.y + o.h/2);
        ctx.fill();
      } else if (o.nombre === "Pulmones") {
        ctx.beginPath();
        ctx.ellipse(o.x, o.y + 13, 20, 30, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(o.x + 80, o.y + 13, 20, 30, 0, 0, Math.PI * 2);
        ctx.fill();
      } else if (o.nombre === "H√≠gado") {
        ctx.beginPath();
        ctx.moveTo(o.x, o.y);
        ctx.quadraticCurveTo(o.x + o.w, o.y, o.x + o.w, o.y + o.h);
        ctx.quadraticCurveTo(o.x, o.y + o.h + 20, o.x, o.y);
        ctx.fill();
      } else if (o.nombre === "Ri√±√≥n") {
        ctx.beginPath();
        ctx.arc(o.x + o.w/2, o.y + o.h/2, 20, 0, Math.PI * 2);
        ctx.fill();
      } else if (o.nombre === "Est√≥mago") {
        ctx.beginPath();
        ctx.ellipse(o.x, o.y, o.w/2, o.h/2, 0, 0, Math.PI * 2);
        ctx.fill();
      }
    }
  });

 // üîπ Dibujar huesos primero
  organos.forEach(o => {
    if (!o.extraido && o.tipo === "hueso") {
      ctx.fillStyle = "yellow";
      ctx.strokeStyle = "green";
      ctx.lineWidth = 2;
      ctx.fillRect(o.x, o.y, o.w, o.h);
      ctx.strokeRect(o.x, o.y, o.w, o.h);
    }
  });

}

// üîπ Extraer huesos y √≥rganos
canvas.addEventListener("click", (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  for (let o of organos) {
    if (!o.extraido &&
        x >= o.x && x <= o.x + o.w &&
        y >= o.y && y <= o.y + o.h) {

      if (o.tipo === "organo" && o.protegidoPor) {
        const hueso = organos.find(h => h.nombre === o.protegidoPor && !h.extraido);
        if (hueso) {
          alert("Primero debes arrancar el hueso: " + hueso.nombre);
          return;
        }
      }

      o.extraido = true;
      organoActual = o;
      mostrarOrganoMovil(e.clientX, e.clientY);
      dibujarCuerpoYOrganos();
      break;
    }
  }
});

// üîπ Mostrar el √≥rgano o hueso movi√©ndose
function mostrarOrganoMovil(x, y) {
  orgElem.style.left = x + "px";
  orgElem.style.top = y + "px";
  orgElem.style.display = "block";

  if (organoActual.tipo === "hueso") {
    orgElem.style.background = "white";
    orgElem.style.border = "2px solid black";
    orgElem.style.borderRadius = "0";
  } else {
    orgElem.style.background = "red";
    orgElem.style.border = "none";
    orgElem.style.borderRadius = "50%";
  }
}

document.addEventListener("mousemove", (e) => {
  if (orgElem.style.display === "block") {
    orgElem.style.left = e.clientX + "px";
    orgElem.style.top = e.clientY + "px";
  }
});

const sonidoCorrecto = new Audio('../sonidos/correct-156911.mp3');
const sonidoIncorrecto = new Audio('../sonidos/error-3-125761.mp3');

document.addEventListener("mouseup", (e) => {
  if (orgElem.style.display === "block") {
    const canastas = document.querySelectorAll(".partes");
    let colocado = false;

 // üîπ Caso HUESO
if (organoActual.tipo === "hueso") {
  for (let c of canastas) {
    const rect = c.getBoundingClientRect();
    if (e.clientX >= rect.left && e.clientX <= rect.right &&
        e.clientY >= rect.top && e.clientY <= rect.bottom) {

      if (c.innerText === "S. esqueletico") {
  // ‚úÖ hueso correcto ‚Üí desaparece y suma punto
  correctos++;
  document.getElementById("correctos").innerText = correctos;
  sonidoCorrecto.play();
  organoActual.extraido = true; // se queda eliminado del cuerpo
} else {
  // ‚ùå mal ‚Üí error y SE REGENERA
  incorrectos++;
  document.getElementById("incorrectos").innerText = incorrectos;
  sonidoIncorrecto.play();
  organoActual.extraido = false; // vuelve al cuerpo
}


      colocado = true;
      break;
    }
  }

  if (!colocado) {
    // ‚ùå Si no se puso en canasta ‚Üí error y el hueso se regenera
    incorrectos++;
    document.getElementById("incorrectos").innerText = incorrectos;
    sonidoIncorrecto.play();
    organoActual.extraido = false;
  }

  // üîπ Actualizamos el canvas y ocultamos el elemento suelto
  dibujarCuerpoYOrganos();
  orgElem.style.display = "none";
  organoActual = null;
  return;
}


    // üîπ Caso √ìRGANO
    for (let c of canastas) {
      const rect = c.getBoundingClientRect();
      if (e.clientX >= rect.left && e.clientX <= rect.right &&
          e.clientY >= rect.top && e.clientY <= rect.bottom) {

        if (c.innerText === organoActual.sistema) {
          correctos++;
          document.getElementById("correctos").innerText = correctos;
          sonidoCorrecto.play();

          // ‚úÖ Si este √≥rgano estaba protegido ‚Üí regeneramos el hueso SIN dar puntos
          if (organoActual.protegidoPor) {
            const hueso = organos.find(h => h.nombre === organoActual.protegidoPor);
            if (hueso) hueso.extraido = false; // vuelve al cuerpo
          }

        } else {
          incorrectos++;
          document.getElementById("incorrectos").innerText = incorrectos;
          sonidoIncorrecto.play();
        }

        colocado = true;
        break;
      }
    }

    if (!colocado) {
      incorrectos++;
      document.getElementById("incorrectos").innerText = incorrectos;
      sonidoIncorrecto.play();
    }

    // El √≥rgano siempre se regenera
    organoActual.extraido = false;
    dibujarCuerpoYOrganos();

    orgElem.style.display = "none";
    organoActual = null;
    generarNuevoDesafio();
  }
});

function generarNuevoDesafio() {
  if (organos.every(o => o.extraido)) {
    clonarOrganos();
  }
  // üîπ Solo √≥rganos (excluye huesos)
  const restantes = organos.filter(o => !o.extraido && o.tipo === "organo");
  const aleatorio = restantes[Math.floor(Math.random() * restantes.length)];
  document.getElementById("partes").innerText = aleatorio.sistema;
}


function iniciarJuego() {
  clonarOrganos();
  iniciarTemporizador();
  dibujarCuerpoYOrganos();
  generarNuevoDesafio();
}

window.onload = iniciarJuego;
</script>

</body>
</html>
