<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Naturalgames</title>
</head>
<body>

<div class="cubo">
  <div class="cubo1">
    <canvas class="cuerpo" id="canvas" width="400" height="500"></canvas>
    <div class="canasta" id="canasta">CANASTA</div>
  </div>

  <div class="cubo2">
    <div class="texto" id="partes">Corta la cabeza</div>
    <img class="pequeñin" src="../imagenes/peque456.png">
    <div class="tiempo" id="tiempo">5:00</div>
    <div class="puntos">
      <div class="correcto">C: <span id="correctos">0</span></div>
      <div class="incorrecto">F: <span id="incorrectos">0</span></div>
    </div>
  </div>
</div>

<div id="resultado" class="res" style="display:none;">
  <h2>Juego terminado</h2>
  <p>Puntuación final: <span id="puntajeFinal"></span></p>
  <p>Nota: <span id="nota"></span></p>
  <div class="botones">
    <button class="boton2" onclick="location.reload()">Reiniciar</button>
    <button class="boton2" onclick="salir()">Escoger otro</button>
  </div>
</div>

<style>
  @import url("../CSS/prueba6.css");
</style>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let dibujoLibre = [];
let dibujando = false;
let parteCortada = null;
let textoActual = "Cabeza";
let correctos = 0;
let incorrectos = 0;
let tiempo = 300;
let interval;

// Lista de partes del cuerpo (zonas aproximadas para cortar)
const partes = [
  { nombre: "Cabeza", x: 200, y: 80, r: 40 },
  { nombre: "Torso", x: 200, y: 200, w: 120, h: 180 },
  { nombre: "Brazo izquierdo", x: 120, y: 200, w: 50, h: 120 },
  { nombre: "Brazo derecho", x: 280, y: 200, w: 50, h: 120 },
  { nombre: "Pierna izquierda", x: 170, y: 360, w: 40, h: 120 },
  { nombre: "Pierna derecha", x: 230, y: 360, w: 40, h: 120 },
  { nombre: "Mano izquierda", x: 95, y: 250, r: 15 },
  { nombre: "Mano derecha", x: 305, y: 250, r: 15 },
  { nombre: "Pie izquierdo", x: 160, y: 435, w: 70, h: 30 },
  { nombre: "Pie derecho", x: 240, y: 435, w: 70, h: 30 }
];

function dibujarCuerpo() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "yellow";
  ctx.strokeStyle = "green";

  // --- Cabeza ---
  ctx.beginPath();
  ctx.arc(200, 80, 40, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();

  // --- Torso ---
  ctx.beginPath();
  ctx.ellipse(200, 200, 60, 90, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();

  // --- Brazos ---
  ctx.beginPath();
  ctx.ellipse(120, 200, 25, 70, Math.PI/8, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();

  ctx.beginPath();
  ctx.ellipse(280, 200, 25, 70, -Math.PI/8, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();

  // --- Manos ---
  ctx.beginPath();
  ctx.arc(95, 250, 20, 0, Math.PI * 2); // izquierda
  ctx.fill();
  ctx.stroke();

  ctx.beginPath();
  ctx.arc(305, 250, 20, 0, Math.PI * 2); // derecha
  ctx.fill();
  ctx.stroke();

  // --- Piernas ---
  ctx.beginPath();
  ctx.ellipse(170, 360, 25, 80, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();

  ctx.beginPath();
  ctx.ellipse(230, 360, 25, 80, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.stroke();

  // --- Pies girados ---
  ctx.beginPath();
  ctx.ellipse(160, 435, 35, 15, -Math.PI/8, 0, Math.PI * 2); // pie izquierdo
  ctx.fill();
  ctx.stroke();

  ctx.beginPath();
  ctx.ellipse(240, 435, 35, 15, Math.PI/8, 0, Math.PI * 2); // pie derecho
  ctx.fill();
  ctx.stroke();

  // --- Parte cortada cayendo ---
  if (parteCortada && parteCortada.cayendo) {
    parteCortada.y += parteCortada.vy;
    ctx.fillStyle = "green";
    ctx.beginPath();
    if (parteCortada.r) {
      ctx.arc(parteCortada.x, parteCortada.y, parteCortada.r, 0, Math.PI * 2);
    } else {
      ctx.ellipse(parteCortada.x, parteCortada.y, parteCortada.w/2, parteCortada.h/2, 0, 0, Math.PI * 2);
    }
    ctx.fill();
    ctx.stroke();
  }

  // --- Línea del bisturí ---
  if (dibujoLibre.length > 1) {
    ctx.strokeStyle = "green";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.moveTo(dibujoLibre[0].x, dibujoLibre[0].y);
    for (let i = 1; i < dibujoLibre.length; i++) {
      ctx.lineTo(dibujoLibre[i].x, dibujoLibre[i].y);
    }
    ctx.stroke();
    ctx.lineWidth = 1;
  }
}

// --- eventos del bisturí ---
canvas.addEventListener("mousedown", e => {
  dibujando = true;
  dibujoLibre = [{ x: e.offsetX, y: e.offsetY }];
});

canvas.addEventListener("mousemove", e => {
  if (dibujando) {
    dibujoLibre.push({ x: e.offsetX, y: e.offsetY });
  }
});

canvas.addEventListener("mouseup", e => {
  if (dibujando) {
    dibujando = false;
    detectarCorteLibre();
    setTimeout(() => { dibujoLibre = []; }, 300);
  }
});

function detectarCorteLibre() {
  for (let parte of partes) {
    for (let punto of dibujoLibre) {
      if (parte.r) {
        // detección circular (cabeza, manos)
        let dx = punto.x - parte.x;
        let dy = punto.y - parte.y;
        if (Math.sqrt(dx*dx + dy*dy) <= parte.r) {
          parteCortada = { ...parte, cayendo: true, vy: 3 };
          verificarParte(parte.nombre);
          return;
        }
      } else {
        // detección rectangular aproximada
        if (
          punto.x >= parte.x - parte.w/2 &&
          punto.x <= parte.x + parte.w/2 &&
          punto.y >= parte.y - parte.h/2 &&
          punto.y <= parte.y + parte.h/2
        ) {
          parteCortada = { ...parte, cayendo: true, vy: 3 };
          verificarParte(parte.nombre);
          return;
        }
      }
    }
  }
}

const sonidoCorrecto = new Audio('../sonidos/correct-156911.mp3');
const sonidoIncorrecto = new Audio('../sonidos/error-3-125761.mp3');


function verificarParte(nombreParte) {
  if (nombreParte.toLowerCase() === textoActual.toLowerCase()) {
    correctos++;
    document.getElementById("correctos").innerText = correctos;
      sonidoCorrecto.play(); 
  } else {
    incorrectos++;
    document.getElementById("incorrectos").innerText = incorrectos;
    sonidoIncorrecto.play();
  }
}

function animar() {
  dibujarCuerpo();

  if (parteCortada && parteCortada.cayendo) {
    if (parteCortada.y > canvas.height - 100) {
      parteCortada = null;
      nuevaRonda();
    }
  }

  requestAnimationFrame(animar);
}

function nuevaRonda() {
  const parteAleatoria = partes[Math.floor(Math.random() * partes.length)];
  textoActual = parteAleatoria.nombre;
  document.getElementById("partes").innerText = "Corta la " + textoActual;
  dibujarCuerpo();
}

function iniciarTemporizador() {
  interval = setInterval(() => {
    if (tiempo > 0) {
      tiempo--;
      const minutos = Math.floor(tiempo / 60);
      const segundos = tiempo % 60;
      document.getElementById("tiempo").innerText =
        `${minutos.toString().padStart(2, "0")}:${segundos.toString().padStart(2, "0")}`;
    } else {
      clearInterval(interval);
      finalizarJuego();
    }
  }, 1000);
}

function finalizarJuego() {
  clearInterval(interval);
  const resultadoFinal = correctos - incorrectos;
  let nota;
  if (resultadoFinal >= 20) nota = "A";
  else if (resultadoFinal >= 10) nota = "B";
  else if (resultadoFinal >= 5) nota = "C";
  else nota = "F";

  document.getElementById("puntajeFinal").innerText = resultadoFinal;
  document.getElementById("nota").innerText = nota;
  document.getElementById("resultado").style.display = "block";
}

function salir() {
  window.location.href = "Naturalgames.html";
}

function iniciarJuego() {
  nuevaRonda();
  dibujarCuerpo();
  iniciarTemporizador();
  animar();
}

window.onload = iniciarJuego;
</script>

</body>
</html>
