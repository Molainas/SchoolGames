<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Naturalgames</title>
</head>
<body>

<div class="cubo">
  <div class="cubo1">
    <div class="correcto">C: <span id="correctos">0</span></div>
    <div class="tiempo" id="tiempo">5:00</div>
    <div class="incorrecto">F: <span id="incorrectos">0</span></div>
  </div>

  <div class="cubo2">
    <div class="imagen">
      <div class="pequeñin1"><img src="../imagenes/pequenin78911.png" class="pequeñin"></div>
      <div class="situacion">
        <div id="estadoTexto" class="texto"></div>
        <canvas id="canvas" class="canvas" width="798" height="298"></canvas>
      </div>
      <div class="pequeñin2"><img src="../imagenes/pequenin78922.png" class="pequeñin"></div>
    </div>

    <div class="temperatura">
      <div class="cambio"><img src="../imagenes/mas.png"></div>
      <div class="cambio"><img src="../imagenes/resetiar.png"></div>
      <div class="cambio"><img src="../imagenes/menos.png"></div>
    </div>
  </div>
</div>

<div id="resultado" class="res" style="display:none;">
  <h2>Juego terminado</h2>
  <p>Puntuación final: <span id="puntajeFinal"></span></p>
  <p>Nota: <span id="nota"></span></p>
  <div class="botones">
    <button class="boton2" onclick="location.reload()">Reiniciar</button>
    <button class="boton2" onclick="salir()">Escoger otro</button>
  </div>
</div>

<style>
    @import url("../CSS/prueba7,2.css");
  </style>

<script>
let correctos = 0;
let incorrectos = 0;
let tiempo = 300;
let interval;
let temperatura = 0;
let estadoActual = "";
let estadoEsperado = "";
let materialActual = "";
let animacionID;

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const materiales = [
  {
    nombre: "Agua",
    obtenerEstado: (temp) => {
      if (temp <= 0) return "sólido";
      else if (temp >= 100) return "gaseoso";
      else return "líquido";
    },
    posibles: ["sólido", "líquido", "gaseoso"]
  },
  {
    nombre: "Metal",
    obtenerEstado: (temp) => {
      if (temp <= 0) return "sólido";
      else if (temp <= 1500) return "líquido";
      else return "plasma";
    },
    posibles: ["sólido", "líquido", "plasma"]
  },
  {
    nombre: "Helio",
    obtenerEstado: (temp) => {
      if (temp <= 0) return "gaseoso";
      else return "plasma";
    },
    posibles: ["gaseoso", "plasma"]
  },
  {
    nombre: "Vidrio",
    obtenerEstado: (temp) => {
      if (temp <= 800) return "sólido";
      else return "líquido";
    },
    posibles: ["sólido", "líquido"]
  }
];


function dibujarEstado(estado) {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // --- Dibujos de estados ---
  if (estado === "sólido") {
    ctx.fillStyle = "yellow";
    ctx.fillRect(370, 70, 60, 60); // Cubito de hielo
    ctx.strokeRect(370, 70, 60, 60);
  } 
  else if (estado === "líquido") {
    ctx.fillStyle = "yellow";
    ctx.beginPath();
    ctx.arc(370, 120, 40, 0, Math.PI * 2); // gota grande
    ctx.fill();
  } 
  else if (estado === "gaseoso") {
    ctx.fillStyle = "yellow";
    for (let i = 0; i < 5; i++) {
      ctx.beginPath();
      ctx.arc(370 + i * 20, 80 + Math.random() * 40, 15, 0, Math.PI * 2); // nubecitas
      ctx.fill();
    }
  } 
  else if (estado === "plasma") {
    ctx.fillStyle = "yellow";
    ctx.beginPath();
    ctx.arc(370, 100, 50, 0, Math.PI * 2); // esfera brillante
    ctx.fill();

    ctx.strokeStyle = "green";
    for (let i = 0; i < 8; i++) {
      let ang = (i * Math.PI) / 4;
      ctx.beginPath();
      ctx.moveTo(370, 100);
      ctx.lineTo(370 + Math.cos(ang) * 70, 100 + Math.sin(ang) * 70);
      ctx.stroke();
    }
  }

  // --- Medidor de temperatura ---
  dibujarMedidor();
}

function dibujarMedidor() {
  // Marco del medidor
  const x = 750, y = 20, ancho = 20, alto = 160;
  ctx.strokeStyle = "yellow";
  ctx.strokeRect(x, y, ancho, alto);

  // Normalizamos temperatura entre -200 y 2000 (rango genérico)
  const tempMin = -200;
  const tempMax = 2000;
  const tempClamped = Math.max(tempMin, Math.min(tempMax, temperatura));

  const porcentaje = (tempClamped - tempMin) / (tempMax - tempMin);
  const alturaRelleno = porcentaje * alto;

  ctx.fillStyle = "yellow";
  ctx.fillRect(x, y + alto - alturaRelleno, ancho, alturaRelleno);

  // Texto de temperatura
  ctx.fillStyle = "yellow";
  ctx.font = "14px Cursive";
  ctx.fillText(`${temperatura}°C`, x - 10, y + alto + 15);
}


function iniciarJuego() {
  iniciarTemporizador();
  nuevaRonda();
  asignarEventosBotones();
}

function iniciarTemporizador() {
  interval = setInterval(() => {
    if (tiempo > 0) {
      tiempo--;
      const minutos = Math.floor(tiempo / 60);
      const segundos = tiempo % 60;
      document.getElementById("tiempo").innerText =
        `${minutos.toString().padStart(2, "0")}:${segundos.toString().padStart(2, "0")}`;
    } else {
      clearInterval(interval);
      finalizarJuego();
    }
  }, 1000);
}

function finalizarJuego() {
  clearInterval(interval);
  cancelAnimationFrame(animacionID);
  const resultadoFinal = correctos - incorrectos;
  let nota;
  if (resultadoFinal >= 20) nota = "A";
  else if (resultadoFinal >= 10) nota = "B";
  else if (resultadoFinal >= 5) nota = "C";
  else nota = "F";

  document.getElementById("puntajeFinal").innerText = resultadoFinal;
  document.getElementById("nota").innerText = nota;
  document.getElementById("resultado").style.display = "block";
}

function salir() {
  window.location.href = "Naturalgames2.html";
}


function nuevaRonda() {
  temperatura = 0;
  const material = materiales[Math.floor(Math.random() * materiales.length)];
  materialActual = material;
  estadoEsperado = material.posibles[Math.floor(Math.random() * material.posibles.length)];
  document.getElementById("estadoTexto").innerHTML = `<strong>${material.nombre}</strong> → <em>${estadoEsperado}</em>`;
  actualizarEstadoActual();
}

function actualizarEstadoActual() {
  estadoActual = materialActual.obtenerEstado(temperatura);
  dibujarEstado(estadoActual);
}

 const sonidoCorrecto = new Audio('../sonidos/correct-156911.mp3');
const sonidoIncorrecto = new Audio('../sonidos/error-3-125761.mp3');


function verificarRespuesta() {
  if (estadoActual === estadoEsperado) {
    correctos++;
    document.getElementById("correctos").innerText = correctos;
    sonidoCorrecto.play(); 
  } else {
    incorrectos++;
    document.getElementById("incorrectos").innerText = incorrectos;
    sonidoIncorrecto.play();
  }
  nuevaRonda();
}

function asignarEventosBotones() {
  const cambios = document.querySelectorAll(".cambio img");
  cambios[0].addEventListener("click", () => {
    temperatura += 50;
    actualizarEstadoActual();
  });
  cambios[1].addEventListener("click", () => {
    verificarRespuesta();
  });
  cambios[2].addEventListener("click", () => {
    temperatura -= 50;
    actualizarEstadoActual();
  });
}

window.onload = iniciarJuego;
</script>

</body>
</html>
